<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Airbridge SDK Integration Guide</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 20px;
    }

    .chat-container {
      width: 100%;
      max-width: 480px;
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      overflow: hidden;
      margin: 20px auto;
    }

    .chat-header {
      background: linear-gradient(135deg, #4F46E5 0%, #7C3AED 100%);
      color: white;
      padding: 20px;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .chat-header-icon {
      width: 40px;
      height: 40px;
      background: rgba(255,255,255,0.2);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
    }

    .chat-header-text h1 {
      font-size: 16px;
      font-weight: 600;
    }

    .chat-header-text p {
      font-size: 12px;
      opacity: 0.8;
      margin-top: 2px;
    }

    .progress-bar {
      background: #f1f5f9;
      padding: 12px 16px;
      border-bottom: 1px solid #e2e8f0;
    }

    .progress-steps {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 11px;
      color: #64748b;
      margin-bottom: 8px;
    }

    .progress-steps span {
      padding: 4px 8px;
      border-radius: 12px;
      background: #e2e8f0;
      transition: all 0.3s;
    }

    .progress-steps span.active {
      background: #4F46E5;
      color: white;
    }

    .progress-steps span.completed {
      background: #22c55e;
      color: white;
    }

    .progress-track {
      height: 4px;
      background: #e2e8f0;
      border-radius: 2px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #4F46E5, #7C3AED);
      width: 0%;
      transition: width 0.5s ease;
    }

    .chat-messages {
      height: 500px;
      overflow-y: auto;
      padding: 16px;
      background: #f8fafc;
    }

    .message {
      margin-bottom: 16px;
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .bot-message {
      display: flex;
      gap: 8px;
    }

    .bot-avatar {
      width: 32px;
      height: 32px;
      background: linear-gradient(135deg, #4F46E5, #7C3AED);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      flex-shrink: 0;
    }

    .bot-bubble {
      background: white;
      padding: 12px 16px;
      border-radius: 0 16px 16px 16px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      max-width: 85%;
      font-size: 14px;
      line-height: 1.5;
      color: #1e293b;
    }

    .user-message {
      display: flex;
      justify-content: flex-end;
    }

    .user-bubble {
      background: linear-gradient(135deg, #4F46E5, #7C3AED);
      color: white;
      padding: 12px 16px;
      border-radius: 16px 0 16px 16px;
      max-width: 85%;
      font-size: 14px;
    }

    .typing-indicator {
      display: flex;
      gap: 4px;
      padding: 8px 0;
    }

    .typing-dot {
      width: 8px;
      height: 8px;
      background: #94a3b8;
      border-radius: 50%;
      animation: typing 1.4s infinite;
    }

    .typing-dot:nth-child(2) { animation-delay: 0.2s; }
    .typing-dot:nth-child(3) { animation-delay: 0.4s; }

    @keyframes typing {
      0%, 60%, 100% { transform: translateY(0); }
      30% { transform: translateY(-8px); }
    }

    .options-container {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 12px;
    }

    .options-row {
      display: flex;
      gap: 8px;
    }

    .option-btn {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px 16px;
      background: white;
      border: 2px solid #e2e8f0;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 14px;
      color: #1e293b;
      width: 100%;
      text-align: left;
    }

    .option-btn:hover {
      border-color: #4F46E5;
      background: #f5f3ff;
    }

    .option-icon { font-size: 18px; }

    .input-container {
      margin-top: 12px;
    }

    .input-field {
      width: 100%;
      padding: 12px;
      border: 2px solid #e2e8f0;
      border-radius: 10px;
      font-size: 14px;
      margin-bottom: 8px;
      transition: border-color 0.2s;
    }

    .input-field:focus {
      outline: none;
      border-color: #4F46E5;
    }

    textarea.input-field {
      min-height: 80px;
      resize: vertical;
    }

    .submit-btn {
      width: 100%;
      padding: 12px;
      background: linear-gradient(135deg, #4F46E5, #7C3AED);
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .submit-btn:hover:not(:disabled) {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(79, 70, 229, 0.4);
    }

    .submit-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .submit-btn.secondary {
      background: #f1f5f9;
      color: #475569;
    }

    .submit-btn.secondary:hover:not(:disabled) {
      background: #e2e8f0;
      box-shadow: none;
      transform: none;
    }

    .btn-row {
      display: flex;
      gap: 8px;
      margin-top: 8px;
    }

    .btn-row .submit-btn { flex: 1; }

    .code-block {
      background: #1e293b;
      color: #e2e8f0;
      padding: 16px;
      border-radius: 10px;
      font-family: 'SF Mono', Monaco, monospace;
      font-size: 12px;
      overflow-x: auto;
      margin-top: 12px;
      position: relative;
      white-space: pre-wrap;
      word-break: break-all;
    }

    .copy-btn {
      position: absolute;
      top: 8px;
      right: 8px;
      padding: 4px 12px;
      background: #475569;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 11px;
      cursor: pointer;
      transition: background 0.2s;
    }

    .copy-btn:hover { background: #64748b; }
    .copy-btn.copied { background: #22c55e; }

    .chip {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 500;
    }

    .chip.green { background: #dcfce7; color: #16a34a; }
    .chip.orange { background: #ffedd5; color: #ea580c; }
    .chip.blue { background: #dbeafe; color: #2563eb; }

    .warning-box {
      background: #fef3c7;
      border-left: 4px solid #f59e0b;
      padding: 12px 14px;
      border-radius: 0 8px 8px 0;
      margin-top: 12px;
      font-size: 13px;
      color: #92400e;
    }

    .info-box {
      background: #dbeafe;
      border-left: 4px solid #3b82f6;
      padding: 12px 14px;
      border-radius: 0 8px 8px 0;
      margin-top: 12px;
      font-size: 13px;
      color: #1e40af;
    }

    .success-box {
      background: #dcfce7;
      border-left: 4px solid #22c55e;
      padding: 12px 14px;
      border-radius: 0 8px 8px 0;
      margin-top: 12px;
      font-size: 13px;
      color: #166534;
    }

    .error-box {
      background: #fee2e2;
      border-left: 4px solid #ef4444;
      padding: 12px 14px;
      border-radius: 0 8px 8px 0;
      margin-top: 12px;
      font-size: 13px;
      color: #991b1b;
    }

    .step-box {
      background: #f8fafc;
      border: 1px solid #e2e8f0;
      border-radius: 12px;
      padding: 16px;
      margin-top: 12px;
    }

    .step-box h4 {
      font-size: 14px;
      color: #1e293b;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .step-box ol, .step-box ul {
      padding-left: 20px;
      font-size: 13px;
      color: #475569;
    }

    .step-box li { margin-bottom: 8px; }
    .step-box li:last-child { margin-bottom: 0; }

    .checklist {
      margin-top: 12px;
    }

    .checklist-item {
      display: flex;
      align-items: flex-start;
      gap: 10px;
      padding: 10px 14px;
      background: #f8fafc;
      border-radius: 10px;
      margin-bottom: 8px;
      font-size: 13px;
      color: #475569;
    }

    .checklist-item:last-child { margin-bottom: 0; }

    .checklist-item input[type="checkbox"] {
      display: none;
    }

    .checklist-item label, label.checklist-item {
      cursor: pointer;
      transition: background-color 0.2s;
    }

    .checklist-item label:hover, label.checklist-item:hover {
      background-color: #f1f5f9;
    }

    .checklist-item .icon {
      flex-shrink: 0;
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .checklist-item.done { background: #dcfce7; color: #166534; }
    .checklist-item.pending { background: #fef3c7; color: #92400e; }

    .feature-card {
      background: white;
      border: 1px solid #e2e8f0;
      border-radius: 12px;
      padding: 16px;
      margin-top: 12px;
    }

    .feature-card-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 8px;
    }

    .feature-card-header .icon { font-size: 20px; }

    .feature-card-header h5 {
      font-size: 14px;
      color: #1e293b;
      font-weight: 600;
    }

    .feature-card p {
      font-size: 13px;
      color: #64748b;
      margin-bottom: 12px;
    }

    .mock-ui {
      background: #1e293b;
      border-radius: 8px;
      padding: 12px;
      margin-top: 12px;
    }

    .mock-ui-header {
      display: flex;
      gap: 6px;
      margin-bottom: 8px;
    }

    .mock-ui-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
    }

    .mock-ui-dot.red { background: #ef4444; }
    .mock-ui-dot.yellow { background: #f59e0b; }
    .mock-ui-dot.green { background: #22c55e; }

    .mock-ui-content {
      font-family: 'SF Mono', Monaco, monospace;
      font-size: 11px;
      color: #94a3b8;
    }

    .mock-ui-row {
      padding: 4px 8px;
      border-radius: 4px;
      margin-bottom: 4px;
    }

    .mock-ui-row:last-child { margin-bottom: 0; }
    .mock-ui-row.highlight { background: rgba(34, 197, 94, 0.2); color: #4ade80; }
    .mock-ui-row .time { color: #64748b; }
    .mock-ui-row .event { color: #38bdf8; }
    .mock-ui-row .category { color: #fbbf24; }

    .summary-table {
      width: 100%;
      margin-top: 12px;
      border-collapse: collapse;
      font-size: 12px;
    }

    .summary-table th, .summary-table td {
      padding: 8px 10px;
      border: 1px solid #e2e8f0;
      text-align: left;
    }

    .summary-table th {
      background: #f8fafc;
      font-weight: 600;
      color: #475569;
    }

    .summary-table td { color: #64748b; }

    .success-animation {
      text-align: center;
      padding: 20px;
    }

    .success-icon {
      font-size: 48px;
      margin-bottom: 12px;
      animation: successPop 0.5s ease-out;
    }

    @keyframes successPop {
      0% { transform: scale(0); }
      50% { transform: scale(1.2); }
      100% { transform: scale(1); }
    }

    a { color: #4F46E5; }

    .submit-btn {
      color: white !important;
      text-decoration: none !important;
    }

    a.submit-btn {
      display: block;
      text-align: center;
      color: white !important;
    }

    a.submit-btn:visited,
    a.submit-btn:hover,
    a.submit-btn:active {
      color: white !important;
    }
  </style>
</head>
<body>
  <div class="chat-container">
    <div class="chat-header">
      <div class="chat-header-icon">ğŸš€</div>
      <div class="chat-header-text">
        <h1>Airbridge SDK Integration Guide</h1>
        <p>Configure only what you need</p>
      </div>
    </div>

    <div class="progress-bar">
      <div class="progress-steps">
        <span id="step1">Setup</span>
        <span id="step2">Events</span>
        <span id="step3">Features</span>
        <span id="step4">Done</span>
      </div>
      <div class="progress-track">
        <div class="progress-fill" id="progressFill"></div>
      </div>
    </div>

    <div class="chat-messages" id="chatMessages"></div>
  </div>

  <script>
    // ========== STATE ==========
    const state = {
      language: '',
      implementationMethod: '',
      appRegistered: false,
      appMode: '',
      platform: '',
      appName: '',
      sdkToken: '',
      hasIOS: false,
      hasAds: false,
      needsDeeplink: false,
      needsUserIdentity: false,
      needsRevenue: false,
      events: [],
      templateParts: { core: '', ios: '', deeplink: '', userIdentity: '', revenue: '' }
    };

    // ========== TRANSLATIONS ==========
    const t = {
      ko: {
        headerTitle: 'Airbridge SDK ì—°ë™ ê°€ì´ë“œ',
        headerSubtitle: 'í•„ìš”í•œ ê²ƒë§Œ ê³¨ë¼ì„œ ì„¤ì •í•˜ê¸°',
        step1: 'ê¸°ë³¸ì„¤ì •',
        step2: 'ì´ë²¤íŠ¸',
        step3: 'ì¶”ê°€ê¸°ëŠ¥',
        step4: 'ì™„ë£Œ',
        selectLanguage: 'ì–¸ì–´ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”',
        langKorean: 'í•œêµ­ì–´',
        langEnglish: 'English',
        welcome1: 'ì•ˆë…•í•˜ì„¸ìš”! ğŸ‘‹',
        welcome2: '<strong>Airbridge SDK ì—°ë™</strong>ì„ ë„ì™€ë“œë¦´ê²Œìš”.',
        welcome3: 'í•„ìš”í•œ ê¸°ëŠ¥ë§Œ ì„ íƒí•´ì„œ <strong>ë§ì¶¤í˜• í…œí”Œë¦¿</strong>ì„ ë§Œë“¤ì–´ë“œë¦½ë‹ˆë‹¤.',
        askAppRegistered: 'ë¨¼ì €, <strong>Airbridge ëŒ€ì‹œë³´ë“œì— ì•±ì„ ë“±ë¡</strong>í•˜ì…¨ë‚˜ìš”?',
        yesRegistered: 'ë„¤, ë“±ë¡í–ˆì–´ìš”',
        notYet: 'ì•„ì§ì´ìš”',
        registerFirst: 'ë¨¼ì € ì•±ì„ ë“±ë¡í•´ì•¼ í•´ìš”.',
        registerStepTitle: 'ğŸ“ ì•± ë“±ë¡í•˜ê¸°',
        registerStep1: 'ì ‘ì†',
        registerStep2: 'ë¡œê·¸ì¸ í›„ <strong>+ ë²„íŠ¼</strong> í´ë¦­',
        registerStep3: 'ì•± ì •ë³´ ì…ë ¥',
        unchangeableWarning: 'âš ï¸ <strong>ë“±ë¡ í›„ ë³€ê²½ ë¶ˆê°€:</strong>',
        unchangeableItems: 'â€¢ App Name (ì†Œë¬¸ì+ìˆ«ìë§Œ)<br>â€¢ App Mode (Production/Development)<br>â€¢ Time Zone, Currency',
        testAppTip: 'ğŸ’¡ í…ŒìŠ¤íŠ¸ìš© ì•±ì€ ì´ë¦„ì— "dev" ë˜ëŠ” "test" í¬í•¨ ê¶Œì¥',
        registrationDone: 'ë“±ë¡ ì™„ë£Œí–ˆì–´ìš”!',
        askAppMode: 'ì•±ì„ ì–´ë–¤ <strong>ëª¨ë“œ</strong>ë¡œ ë“±ë¡í•˜ì…¨ë‚˜ìš”?',
        appModeWarning: 'âš ï¸ ì•± ëª¨ë“œëŠ” ë“±ë¡ í›„ ë³€ê²½í•  ìˆ˜ ì—†ì–´ìš”',
        productionMode: 'ìš´ì˜ ëª¨ë“œ',
        productionModeDesc: 'ì•±ë§ˆì¼“ ì¶œì‹œìš© (ì‹¤ì œ ìº í˜ì¸ ìš´ì˜)',
        developmentMode: 'ê°œë°œ ëª¨ë“œ',
        developmentModeDesc: 'í…ŒìŠ¤íŠ¸/ìŠ¤í…Œì´ì§•ìš© (ë‚´ë¶€ í…ŒìŠ¤íŠ¸)',
        selectedProduction: 'ìš´ì˜ ëª¨ë“œë¡œ ë“±ë¡í–ˆì–´ìš”',
        selectedDevelopment: 'ê°œë°œ ëª¨ë“œë¡œ ë“±ë¡í–ˆì–´ìš”',
        productionTip: 'âœ… ì‹¤ì œ ìº í˜ì¸ ì„±ê³¼ë¥¼ ì¸¡ì •í•  ìˆ˜ ìˆì–´ìš”.',
        developmentTip: 'âœ… í…ŒìŠ¤íŠ¸ ë°ì´í„°ê°€ ìš´ì˜ ë°ì´í„°ì™€ ì„ì´ì§€ ì•Šì•„ìš”.',
        askImplementation: '<strong>SDK ì—°ë™ì„ ì–´ë–»ê²Œ ì§„í–‰í•˜ì‹œë‚˜ìš”?</strong>',
        implAI: 'AIë¡œ ì§ì ‘ êµ¬í˜„',
        implAIDesc: 'Claude Code ë“±ìœ¼ë¡œ ì§ì ‘ ê°œë°œ',
        implDevTeam: 'ê°œë°œíŒ€ì— ìš”ì²­',
        implDevTeamDesc: 'ìš”êµ¬ì‚¬í•­ì„ ì •ë¦¬í•´ì„œ ì „ë‹¬',
        implAISelected: 'AIë¡œ ì§ì ‘ êµ¬í˜„í• ê²Œìš”',
        implDevTeamSelected: 'ê°œë°œíŒ€ì— ìš”ì²­í•  ê±°ì˜ˆìš”',
        implAIResponse: 'ì¢‹ì•„ìš”! ğŸ’ª Claude Codeì—ì„œ ë°”ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” <strong>í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿</strong>ì„ ë§Œë“¤ì–´ë“œë¦´ê²Œìš”.',
        implDevTeamResponse: 'ì•Œê² ì–´ìš”! ê°œë°œíŒ€ì—ê²Œ ì „ë‹¬í•  ìˆ˜ ìˆëŠ” <strong>ìš”êµ¬ì‚¬í•­ ëª…ì„¸ì„œ</strong>ì™€ <strong>í™•ì¸ ì²´í¬ë¦¬ìŠ¤íŠ¸</strong>ë¥¼ ë§Œë“¤ì–´ë“œë¦´ê²Œìš”.',
        askPlatform: 'ì–´ë–¤ í”Œë«í¼ìœ¼ë¡œ ê°œë°œí•˜ê³  ìˆë‚˜ìš”?',
        askiOSSupport: 'ì´ ì•±ì´ <strong>iOSë„ ì§€ì›</strong>í•˜ë‚˜ìš”?',
        iOSTip: 'ğŸ’¡ iOS ì•±ì´ë©´ ì¶”ê°€ ì„¤ì •(ATT, SKAN)ì´ í•„ìš”í•´ìš”',
        yesiOS: 'ë„¤, iOS ì§€ì›í•´ìš”',
        androidOnly: 'Androidë§Œì´ìš”',
        askSDKToken: 'ì´ì œ <strong>SDK í† í°</strong>ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.',
        tokenLocationTitle: 'ğŸ“ í† í° ì°¾ëŠ” ê³³',
        tokenStep1: 'â†’ ì•± ì„ íƒ',
        tokenStep2: '<strong>Settings</strong> (âš™ï¸) í´ë¦­',
        tokenStep3: '<strong>Tokens</strong> íƒ­ì—ì„œ ë³µì‚¬',
        appNamePlaceholder: 'App Name (ì˜ˆ: myshop)',
        sdkTokenPlaceholder: 'SDK Token (32ìë¦¬)',
        next: 'ë‹¤ìŒ',
        basicInfoDone: 'ê¸°ë³¸ ì •ë³´ ì…ë ¥ ì™„ë£Œ! âœ…',
        askEvents: 'ì´ì œ <strong>íŠ¸ë˜í‚¹í•  ì´ë²¤íŠ¸</strong>ë¥¼ ì •í• ê²Œìš”.',
        basicEventsIncluded: 'ê¸°ë³¸ ì´ë²¤íŠ¸(íšŒì›ê°€ì…, ë¡œê·¸ì¸)ëŠ” ìë™ìœ¼ë¡œ í¬í•¨ë©ë‹ˆë‹¤.',
        signUp: 'íšŒì›ê°€ì…',
        signIn: 'ë¡œê·¸ì¸',
        askRevenue: '<strong>êµ¬ë§¤/ê²°ì œ ê°™ì€ ë§¤ì¶œ ì´ë²¤íŠ¸</strong>ë¥¼ íŠ¸ë˜í‚¹í•˜ê³  ì‹¶ìœ¼ì„¸ìš”?',
        revenueTip: 'ğŸ’¡ ë§¤ì¶œ ì´ë²¤íŠ¸ë¥¼ ì¶”ê°€í•˜ë©´ ROAS(ê´‘ê³ ìˆ˜ìµë¥ ) ë¶„ì„ì´ ê°€ëŠ¥í•´ìš”',
        yesNeed: 'ë„¤, í•„ìš”í•´ìš”',
        skip: 'ì•„ë‹ˆìš”, ê±´ë„ˆë›¸ê²Œìš”',
        revenueNeeded: 'ë§¤ì¶œ ì´ë²¤íŠ¸ í•„ìš”í•´ìš”',
        skipped: 'ê±´ë„ˆë›¸ê²Œìš”',
        revenueAdded: 'ë§¤ì¶œ ê´€ë ¨ ì´ë²¤íŠ¸ë¥¼ ì¶”ê°€í–ˆì–´ìš”:',
        productViewed: 'ìƒí’ˆ ì¡°íšŒ',
        addToCart: 'ì¥ë°”êµ¬ë‹ˆ ì¶”ê°€',
        orderCompleted: 'êµ¬ë§¤ ì™„ë£Œ',
        askAdditionalEvents: '<strong>ì¶”ê°€ë¡œ íŠ¸ë˜í‚¹í•˜ê³  ì‹¶ì€ ì´ë²¤íŠ¸</strong>ê°€ ìˆë‚˜ìš”?',
        addCustom: 'ì§ì ‘ ì¶”ê°€í• ê²Œìš”',
        enough: 'ì´ ì •ë„ë©´ ì¶©ë¶„í•´ìš”',
        customEventTitle: 'ğŸ“ ì¶”ê°€ ì´ë²¤íŠ¸ ì…ë ¥',
        customEventDesc: 'ì´ë²¤íŠ¸ë¥¼ í•œ ì¤„ì”© ì…ë ¥í•˜ì„¸ìš”',
        customEventPlaceholder: 'ì˜ˆ:\nê²€ìƒ‰\nê³µìœ \nì¢‹ì•„ìš”',
        addEvents: 'ì¶”ê°€í•˜ê¸°',
        eventsAdded: 'ì´ë²¤íŠ¸ë¥¼ ì¶”ê°€í–ˆì–´ìš”:',
        askAds: '<strong>ê´‘ê³ ë¥¼ ì§‘í–‰</strong>í•˜ê³  ê³„ì‹œë‚˜ìš”?',
        adsTip: 'ğŸ’¡ ê´‘ê³  ì„±ê³¼ ì¸¡ì •ì„ ìœ„í•œ ì–´íŠ¸ë¦¬ë·°ì…˜ ì„¤ì •ì´ í•„ìš”í•´ìš”',
        yesAds: 'ë„¤, ê´‘ê³ í•´ìš”',
        noAds: 'ì•„ë‹ˆìš”',
        adsYes: 'ê´‘ê³ í•˜ê³  ìˆì–´ìš”',
        adsNo: 'ê´‘ê³  ì•ˆ í•´ìš”',
        adsAddedInfo: 'âœ… ê´‘ê³  ì„±ê³¼ ì¸¡ì •ì„ ìœ„í•´ ì±„ë„ ì—°ë™ì´ í•„ìš”í•´ìš”.',
        adsNextStep: 'ëŒ€ì‹œë³´ë“œ [Channel Integration]ì—ì„œ ê´‘ê³  ì±„ë„ì„ ì—°ë™í•˜ì„¸ìš”.',
        askDeeplink: '<strong>ë”¥ë§í¬(ì•± ë‚´ íŠ¹ì • í™”ë©´ìœ¼ë¡œ ì´ë™)</strong>ê°€ í•„ìš”í•˜ì„¸ìš”?',
        deeplinkTip: 'ğŸ’¡ ê´‘ê³  í´ë¦­ â†’ ì•± ì„¤ì¹˜ â†’ íŠ¹ì • í™”ë©´ ì´ë™ì— ì‚¬ìš©',
        yesDeeplink: 'ë„¤, í•„ìš”í•´ìš”',
        noDeeplink: 'í•„ìš” ì—†ì–´ìš”',
        deeplinkNeeded: 'ë”¥ë§í¬ í•„ìš”í•´ìš”',
        deeplinkNotNeeded: 'ë”¥ë§í¬ í•„ìš” ì—†ì–´ìš”',
        deeplinkAdded: 'âœ… ë”¥ë§í¬ ì„¤ì •ì„ í…œí”Œë¦¿ì— í¬í•¨í• ê²Œìš”.',
        askUserIdentity: '<strong>ë¡œê·¸ì¸í•œ ìœ ì €ë¥¼ ì‹ë³„</strong>í•´ì•¼ í•˜ë‚˜ìš”?',
        userIdentityTip: 'ğŸ’¡ í¬ë¡œìŠ¤ ë””ë°”ì´ìŠ¤ ì¶”ì , ìœ ì €ë³„ ë¶„ì„ì— í•„ìš”',
        yesUserIdentity: 'ë„¤, í•„ìš”í•´ìš”',
        noUserIdentity: 'í•„ìš” ì—†ì–´ìš”',
        userIdentityNeeded: 'ìœ ì € ì‹ë³„ í•„ìš”í•´ìš”',
        userIdentityNotNeeded: 'ìœ ì € ì‹ë³„ í•„ìš” ì—†ì–´ìš”',
        userIdentityAdded: 'âœ… ìœ ì € ì‹ë³„ì ì„¤ì •ì„ í…œí”Œë¦¿ì— í¬í•¨í• ê²Œìš”.',
        summaryItem: 'í•­ëª©',
        summarySetting: 'ì„¤ì •',
        summaryPlatform: 'í”Œë«í¼',
        summaryiOS: 'iOS ì§€ì›',
        summaryEvents: 'ì´ë²¤íŠ¸',
        summaryRevenue: 'ë§¤ì¶œ íŠ¸ë˜í‚¹',
        summaryDeeplink: 'ë”¥ë§í¬',
        summaryUserIdentity: 'ìœ ì € ì‹ë³„ì',
        summaryATT: 'ATT ì„¤ì •',
        yes: 'ì˜ˆ',
        no: 'ì•„ë‹ˆì˜¤',
        pasteToClaudeCode: 'ì•„ë˜ í…œí”Œë¦¿ì„ <strong>Claude Code</strong>ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”:',
        sendToDevTeam: 'ì•„ë˜ <strong>ìš”êµ¬ì‚¬í•­ ëª…ì„¸ì„œ</strong>ë¥¼ ê°œë°œíŒ€ì—ê²Œ ì „ë‹¬í•˜ì„¸ìš”:',
        copy: 'ë³µì‚¬',
        copied: 'ë³µì‚¬ë¨!',
        verificationTitle: '<strong>ì—°ë™ ì™„ë£Œ í›„ í™•ì¸ ë°©ë²•:</strong>',
        realtimeLogTitle: 'ğŸ” ì‹¤ì‹œê°„ ë¡œê·¸ í™•ì¸',
        verifyStep1: 'ì•± ì‹¤í–‰ (ì‹œë®¬ë ˆì´í„°/ì‹¤ê¸°ê¸°)',
        verifyStep2: 'ì ‘ì†',
        verifyStep3: '[Raw Data] â†’ [App Real-time Log]',
        verifyStep4: 'ì´ë²¤íŠ¸ ë°œìƒì‹œí‚¤ê³  ë¡œê·¸ í™•ì¸',
        verifySuccess: 'âœ… ì´ë²¤íŠ¸ê°€ 1~2ì´ˆ ë‚´ì— ë³´ì´ë©´ ì„±ê³µ!',
        verifyDelay: 'âš ï¸ ìµœê·¼ 10ë¶„ ì´ë‚´ ì´ë²¤íŠ¸ëŠ” ì¡°íšŒ ì§€ì—°ë  ìˆ˜ ìˆì–´ìš”',
        eventNotShowing: 'ì´ë²¤íŠ¸ê°€ ì•ˆ ë³´ì—¬ìš”',
        troubleshootTitle: '<strong>ë¬¸ì œ í•´ê²° ì²´í¬ë¦¬ìŠ¤íŠ¸:</strong>',
        troubleshoot1: 'SDK í† í°ì´ ì •í™•í•œê°€ìš”?',
        troubleshoot2: 'ì•± ì´ë¦„ì´ ëŒ€ì‹œë³´ë“œì™€ ì¼ì¹˜í•˜ë‚˜ìš”?',
        troubleshoot3: 'ì´ë²¤íŠ¸ í˜¸ì¶œ ì½”ë“œê°€ ì‹¤í–‰ë˜ë‚˜ìš”?',
        troubleshoot4: 'ë„¤íŠ¸ì›Œí¬ ì—°ê²° ìƒíƒœ í™•ì¸',
        askClaudeCode: 'Claude Codeì— ì´ë ‡ê²Œ ìš”ì²­í•˜ì„¸ìš”:',
        askDevTeam: '<strong>ê°œë°œíŒ€ì— í™•ì¸ ìš”ì²­:</strong>',
        nextStepsBtn: 'ë‹¤ìŒ ë‹¨ê³„ ì•ˆë‚´',
        restartBtn: 'ì²˜ìŒë¶€í„° ë‹¤ì‹œ',
        nextStepsTitle: '<strong>ì—°ë™ ì™„ë£Œ í›„ í•  ì¼:</strong>',
        channelIntegration: '<strong>ê´‘ê³  ì±„ë„ ì—°ë™</strong><br>ëŒ€ì‹œë³´ë“œ [Channel Integration]',
        trackingLink: '<strong>íŠ¸ë˜í‚¹ ë§í¬ ìƒì„±</strong><br>ëŒ€ì‹œë³´ë“œ [Tracking Link]',
        skanSetup: '<strong>SKAN ì„¤ì •</strong><br>[Management] > [SKAN Conversion Value]',
        deeplinkDomain: '<strong>ë”¥ë§í¬ ë„ë©”ì¸ ì„¤ì •</strong><br>ëŒ€ì‹œë³´ë“œ [Deep Links]',
        waitData: '<strong>1~2ì¼ ëŒ€ê¸°</strong><br>ë°ì´í„° ì¶©ë¶„íˆ ìˆ˜ì§‘ í›„ ë¦¬í¬íŠ¸ í™•ì¸',
        congrats: 'ìˆ˜ê³ í•˜ì…¨ìŠµë‹ˆë‹¤!',
        congratsSubtitle: 'Airbridge ì—°ë™ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.',
        helpCenter: 'ğŸ“š Airbridge ë„ì›€ë§ ì„¼í„°',
        onPayment: 'ê²°ì œ ì™„ë£Œ ì‹œ',
        onProductView: 'ìƒí’ˆ ìƒì„¸ ì§„ì…',
        onAddToCart: 'ì¥ë°”êµ¬ë‹ˆ ë‹´ê¸°',
        onAction: 'í•´ë‹¹ ì•¡ì…˜ ì‹œ',
        verifyBeforeProceed: 'ì§„í–‰í•˜ê¸° ì „ì— í™•ì¸í•´ì£¼ì„¸ìš”:',
        verifyAppRegistration: 'ì•± ë“±ë¡ í™•ì¸',
        verifyAppCheck1: 'ëŒ€ì‹œë³´ë“œì—ì„œ ì•±ì´ ë³´ì´ë‚˜ìš”?',
        verifyAppCheck2: 'ì•± ì´ë¦„ì´ ì •í™•í•œê°€ìš”?',
        verifyAppCheck3: 'Settings ë©”ë‰´ì— ì ‘ê·¼ ê°€ëŠ¥í•œê°€ìš”?',
        verifyConfirmBtn: 'âœ… í™•ì¸ ì™„ë£Œ',
        verifyHelpBtn: 'â“ ë„ì›€ì´ í•„ìš”í•´ìš”',
        tokenValid: 'âœ… í† í° í˜•ì‹ì´ ì˜¬ë°”ë¦…ë‹ˆë‹¤',
        tokenInvalid: 'âš ï¸ í† í° í˜•ì‹ì„ í™•ì¸í•´ì£¼ì„¸ìš” (32ìë¦¬ ì˜ë¬¸/ìˆ«ì)',
        tokenVerifyTitle: 'SDK í† í° ê²€ì¦',
        tokenVerifyDesc: 'ì…ë ¥í•œ í† í°ì´ ë§ëŠ”ì§€ ëŒ€ì‹œë³´ë“œì—ì„œ í™•ì¸í•˜ì„¸ìš”',
        tokenVerifyStep1: 'app.airbridge.io â†’ ì•± ì„ íƒ',
        tokenVerifyStep2: 'Settings (âš™ï¸) â†’ Tokens íƒ­',
        tokenVerifyStep3: 'SDK Token ê°’ê³¼ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸',
        tokenMismatchWarning: 'í† í°ì´ ë‹¤ë¥´ë©´ ì´ë²¤íŠ¸ê°€ ì „ì†¡ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤'
      },
      en: {
        headerTitle: 'Airbridge SDK Integration Guide',
        headerSubtitle: 'Configure only what you need',
        step1: 'Setup',
        step2: 'Events',
        step3: 'Features',
        step4: 'Done',
        selectLanguage: 'Select your language',
        langKorean: 'í•œêµ­ì–´',
        langEnglish: 'English',
        welcome1: 'Hello! ğŸ‘‹',
        welcome2: "I'll help you with <strong>Airbridge SDK integration</strong>.",
        welcome3: 'Select only the features you need and get a <strong>customized template</strong>.',
        askAppRegistered: 'First, have you <strong>registered your app in the Airbridge dashboard</strong>?',
        yesRegistered: 'Yes, registered',
        notYet: 'Not yet',
        registerFirst: 'You need to register your app first.',
        registerStepTitle: 'ğŸ“ Register App',
        registerStep1: 'Go to',
        registerStep2: 'After login, click <strong>+ button</strong>',
        registerStep3: 'Enter app information',
        unchangeableWarning: 'âš ï¸ <strong>Cannot change after registration:</strong>',
        unchangeableItems: 'â€¢ App Name (lowercase + numbers only)<br>â€¢ App Mode (Production/Development)<br>â€¢ Time Zone, Currency',
        testAppTip: 'ğŸ’¡ For test apps, include "dev" or "test" in the name',
        registrationDone: "Done registering!",
        askAppMode: 'Which <strong>mode</strong> did you register the app in?',
        appModeWarning: 'âš ï¸ App mode cannot be changed after registration',
        productionMode: 'Production',
        productionModeDesc: 'For app store release (real campaigns)',
        developmentMode: 'Development',
        developmentModeDesc: 'For testing/staging (internal use)',
        selectedProduction: 'Registered in Production mode',
        selectedDevelopment: 'Registered in Development mode',
        productionTip: 'âœ… You can measure real campaign performance.',
        developmentTip: 'âœ… Test data stays separate from production data.',
        askImplementation: '<strong>How will you implement the SDK?</strong>',
        implAI: 'Implement with AI',
        implAIDesc: 'Develop directly with Claude Code, etc.',
        implDevTeam: 'Request to Dev Team',
        implDevTeamDesc: 'Organize requirements to hand off',
        implAISelected: "I'll implement with AI",
        implDevTeamSelected: "I'll request to dev team",
        implAIResponse: "Great! ğŸ’ª I'll create a <strong>prompt template</strong> you can use directly in Claude Code.",
        implDevTeamResponse: "Got it! I'll create a <strong>requirements spec</strong> and <strong>verification checklist</strong> you can share with your dev team.",
        askPlatform: 'What platform are you developing on?',
        askiOSSupport: 'Does this app <strong>support iOS</strong>?',
        iOSTip: 'ğŸ’¡ iOS apps require additional settings (ATT, SKAN)',
        yesiOS: 'Yes, supports iOS',
        androidOnly: 'Android only',
        askSDKToken: 'Now, please enter your <strong>SDK token</strong>.',
        tokenLocationTitle: 'ğŸ“ Where to find token',
        tokenStep1: 'â†’ Select app',
        tokenStep2: 'Click <strong>Settings</strong> (âš™ï¸)',
        tokenStep3: 'Copy from <strong>Tokens</strong> tab',
        appNamePlaceholder: 'App Name (e.g., myshop)',
        sdkTokenPlaceholder: 'SDK Token (32 characters)',
        next: 'Next',
        basicInfoDone: 'Basic info complete! âœ…',
        askEvents: "Now let's define the <strong>events to track</strong>.",
        basicEventsIncluded: 'Basic events (sign up, sign in) are automatically included.',
        signUp: 'Sign Up',
        signIn: 'Sign In',
        askRevenue: 'Do you want to track <strong>purchase/payment revenue events</strong>?',
        revenueTip: 'ğŸ’¡ Adding revenue events enables ROAS (Return on Ad Spend) analysis',
        yesNeed: 'Yes, I need it',
        skip: 'No, skip',
        revenueNeeded: 'I need revenue events',
        skipped: "I'll skip",
        revenueAdded: 'Added revenue-related events:',
        productViewed: 'Product Viewed',
        addToCart: 'Add to Cart',
        orderCompleted: 'Order Completed',
        askAdditionalEvents: 'Do you have <strong>additional events to track</strong>?',
        addCustom: "I'll add custom events",
        enough: "This is enough",
        customEventTitle: 'ğŸ“ Add Custom Events',
        customEventDesc: 'Enter one event per line',
        customEventPlaceholder: 'e.g.:\nSearch\nShare\nLike',
        addEvents: 'Add Events',
        eventsAdded: 'Events added:',
        askAds: 'Are you <strong>running ads</strong>?',
        adsTip: 'ğŸ’¡ Attribution setup is needed for ad performance measurement',
        yesAds: 'Yes, running ads',
        noAds: 'No',
        adsYes: 'Running ads',
        adsNo: 'Not running ads',
        adsAddedInfo: 'âœ… Channel integration is needed for ad performance measurement.',
        adsNextStep: 'Connect your ad channels in dashboard [Channel Integration].',
        askDeeplink: 'Do you need <strong>deep linking</strong>?',
        deeplinkTip: 'ğŸ’¡ Used for: Ad click â†’ App install â†’ Navigate to specific screen',
        yesDeeplink: 'Yes, I need it',
        noDeeplink: "Don't need it",
        deeplinkNeeded: 'I need deep linking',
        deeplinkNotNeeded: "Don't need deep linking",
        deeplinkAdded: "âœ… I'll include deep link setup in the template.",
        askUserIdentity: 'Do you need to <strong>identify logged-in users</strong>?',
        userIdentityTip: 'ğŸ’¡ Required for cross-device tracking, per-user analysis',
        yesUserIdentity: 'Yes, I need it',
        noUserIdentity: "Don't need it",
        userIdentityNeeded: 'I need user identification',
        userIdentityNotNeeded: "Don't need user identification",
        userIdentityAdded: "âœ… I'll include user identity setup in the template.",
        summaryItem: 'Item',
        summarySetting: 'Setting',
        summaryPlatform: 'Platform',
        summaryiOS: 'iOS Support',
        summaryEvents: 'Events',
        summaryRevenue: 'Revenue Tracking',
        summaryDeeplink: 'Deep Link',
        summaryUserIdentity: 'User Identity',
        summaryATT: 'ATT Setup',
        yes: 'Yes',
        no: 'No',
        pasteToClaudeCode: 'Paste the template below into <strong>Claude Code</strong>:',
        sendToDevTeam: 'Send the <strong>requirements spec</strong> below to your dev team:',
        copy: 'Copy',
        copied: 'Copied!',
        verificationTitle: '<strong>How to verify after integration:</strong>',
        realtimeLogTitle: 'ğŸ” Check Real-time Log',
        verifyStep1: 'Run app (simulator/real device)',
        verifyStep2: 'Go to',
        verifyStep3: '[Raw Data] â†’ [App Real-time Log]',
        verifyStep4: 'Trigger events and check logs',
        verifySuccess: 'âœ… Success if events appear within 1-2 seconds!',
        verifyDelay: 'âš ï¸ Events from the last 10 minutes may have query delays',
        eventNotShowing: "Events aren't showing",
        troubleshootTitle: '<strong>Troubleshooting checklist:</strong>',
        troubleshoot1: 'Is the SDK token correct?',
        troubleshoot2: 'Does the app name match the dashboard?',
        troubleshoot3: 'Is the event call code being executed?',
        troubleshoot4: 'Check network connection',
        askClaudeCode: 'Ask Claude Code like this:',
        askDevTeam: '<strong>Request to dev team:</strong>',
        nextStepsBtn: 'Next Steps',
        restartBtn: 'Start Over',
        nextStepsTitle: '<strong>Things to do after integration:</strong>',
        channelIntegration: '<strong>Connect Ad Channels</strong><br>Dashboard [Channel Integration]',
        trackingLink: '<strong>Create Tracking Links</strong><br>Dashboard [Tracking Link]',
        skanSetup: '<strong>SKAN Setup</strong><br>[Management] > [SKAN Conversion Value]',
        deeplinkDomain: '<strong>Deep Link Domain Setup</strong><br>Dashboard [Deep Links]',
        waitData: '<strong>Wait 1-2 days</strong><br>Check reports after collecting enough data',
        congrats: 'Great job!',
        congratsSubtitle: 'Airbridge integration is complete.',
        helpCenter: 'ğŸ“š Airbridge Help Center',
        onPayment: 'On payment completion',
        onProductView: 'On product detail view',
        onAddToCart: 'On add to cart',
        onAction: 'On action',
        verifyBeforeProceed: 'Please verify before proceeding:',
        verifyAppRegistration: 'Verify App Registration',
        verifyAppCheck1: 'Can you see the app in dashboard?',
        verifyAppCheck2: 'Is the app name correct?',
        verifyAppCheck3: 'Can you access the Settings menu?',
        verifyConfirmBtn: 'âœ… Verified',
        verifyHelpBtn: 'â“ Need help',
        tokenValid: 'âœ… Token format is valid',
        tokenInvalid: 'âš ï¸ Please check token format (32 alphanumeric characters)',
        tokenVerifyTitle: 'SDK Token Verification',
        tokenVerifyDesc: 'Verify the token matches your dashboard',
        tokenVerifyStep1: 'app.airbridge.io â†’ Select app',
        tokenVerifyStep2: 'Settings (âš™ï¸) â†’ Tokens tab',
        tokenVerifyStep3: 'Verify SDK Token matches',
        tokenMismatchWarning: 'Events will not be sent if token is incorrect'
      }
    };

    function getText(key) {
      return t[state.language]?.[key] || t.ko[key] || key;
    }

    function getHelpLink(path = '') {
      const base = state.language === 'en'
        ? 'https://help.airbridge.io/en'
        : 'https://help.airbridge.io/ko';
      return path ? `${base}${path}` : base;
    }

    const chatMessages = document.getElementById('chatMessages');

    // ========== UTILITIES ==========
    const delay = ms => new Promise(r => setTimeout(r, ms));

    function scrollToBottom() {
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    function updateProgress(step) {
      document.getElementById('progressFill').style.width = `${(step / 4) * 100}%`;
      for (let i = 1; i <= 4; i++) {
        const el = document.getElementById(`step${i}`);
        el.classList.remove('active', 'completed');
        if (i < step) el.classList.add('completed');
        if (i === step) el.classList.add('active');
      }
    }

    function showTyping() {
      const div = document.createElement('div');
      div.className = 'message bot-message';
      div.id = 'typingIndicator';
      div.innerHTML = `
        <div class="bot-avatar">ğŸ¤–</div>
        <div class="bot-bubble">
          <div class="typing-indicator">
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
          </div>
        </div>
      `;
      chatMessages.appendChild(div);
      scrollToBottom();
    }

    function hideTyping() {
      const el = document.getElementById('typingIndicator');
      if (el) el.remove();
    }

    async function addBot(content, options = {}) {
      showTyping();
      await delay(options.delay || 600);
      hideTyping();

      const div = document.createElement('div');
      div.className = 'message bot-message';
      div.innerHTML = `
        <div class="bot-avatar">ğŸ¤–</div>
        <div class="bot-bubble">${content}</div>
      `;
      chatMessages.appendChild(div);
      scrollToBottom();
    }

    function addUser(text) {
      const div = document.createElement('div');
      div.className = 'message user-message';
      div.innerHTML = `<div class="user-bubble">${text}</div>`;
      chatMessages.appendChild(div);
      scrollToBottom();
    }

    function copyToClipboard(text, btn) {
      navigator.clipboard.writeText(text).then(() => {
        const originalText = btn.textContent;
        btn.textContent = getText('copied');
        btn.classList.add('copied');
        setTimeout(() => {
          btn.textContent = getText('copy');
          btn.classList.remove('copied');
        }, 2000);
      });
    }

    // ========== FLOW: LANGUAGE SELECTION ==========
    async function startChat() {
      await delay(500);
      await addBot(`
        <p style="text-align: center; margin-bottom: 8px;">
          <strong>ì–¸ì–´ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</strong><br>
          <span style="color: #64748b;">Select your language</span>
        </p>
        <div class="options-container">
          <button class="option-btn" onclick="selectLanguage('ko')">
            <span class="option-icon">ğŸ‡°ğŸ‡·</span>í•œêµ­ì–´
          </button>
          <button class="option-btn" onclick="selectLanguage('en')">
            <span class="option-icon">ğŸ‡ºğŸ‡¸</span>English
          </button>
        </div>
      `);
    }

    async function selectLanguage(lang) {
      state.language = lang;
      addUser(lang === 'ko' ? 'í•œêµ­ì–´' : 'English');
      document.querySelector('.chat-header-text h1').textContent = getText('headerTitle');
      document.querySelector('.chat-header-text p').textContent = getText('headerSubtitle');
      document.getElementById('step1').textContent = getText('step1');
      document.getElementById('step2').textContent = getText('step2');
      document.getElementById('step3').textContent = getText('step3');
      document.getElementById('step4').textContent = getText('step4');
      await showWelcome();
    }

    // ========== FLOW: PHASE 1 - CORE SETUP ==========
    async function showWelcome() {
      await addBot(`
        <p>${getText('welcome1')}</p>
        <p>${getText('welcome2')}</p>
        <p>${getText('welcome3')}</p>
      `);

      await addBot(`
        <p>${getText('askAppRegistered')}</p>
        <div class="options-container">
          <button class="option-btn" onclick="checkAppRegistered(true)">
            <span class="option-icon">âœ…</span>${getText('yesRegistered')}
          </button>
          <button class="option-btn" onclick="checkAppRegistered(false)">
            <span class="option-icon">âŒ</span>${getText('notYet')}
          </button>
        </div>
      `, { delay: 800 });

      updateProgress(1);
    }

    async function checkAppRegistered(registered) {
      if (registered) {
        state.appRegistered = true;
        addUser(getText('yesRegistered'));
        await showAppRegistrationVerification();
      } else {
        addUser(getText('notYet'));
        await addBot(`
          <p>${getText('registerFirst')}</p>
          <div class="step-box">
            <h4>${getText('registerStepTitle')}</h4>
            <ol>
              <li><a href="https://app.airbridge.io" target="_blank">app.airbridge.io</a> ${getText('registerStep1')}</li>
              <li>${getText('registerStep2')}</li>
              <li>${getText('registerStep3')}</li>
            </ol>
          </div>
          <div class="error-box">
            ${getText('unchangeableWarning')}<br>
            ${getText('unchangeableItems')}
          </div>
          <div class="info-box">
            ${getText('testAppTip')}
          </div>
          <div style="margin-top: 16px;">
            <button class="submit-btn" onclick="checkAppRegistered(true)">${getText('registrationDone')}</button>
          </div>
        `);
      }
    }

    async function showAppRegistrationVerification() {
      await addBot(`
        <p><strong>${getText('verifyAppRegistration')}</strong></p>
        <p>${getText('verifyBeforeProceed')}</p>
        <div class="checklist" id="appVerifyChecklist">
          <label class="checklist-item" style="cursor: pointer;">
            <input type="checkbox" class="verify-check" onchange="updateVerifyButton('appVerify')">
            <span class="icon">â˜</span>
            <span>${getText('verifyAppCheck1')}</span>
          </label>
          <label class="checklist-item" style="cursor: pointer;">
            <input type="checkbox" class="verify-check" onchange="updateVerifyButton('appVerify')">
            <span class="icon">â˜</span>
            <span>${getText('verifyAppCheck2')}</span>
          </label>
          <label class="checklist-item" style="cursor: pointer;">
            <input type="checkbox" class="verify-check" onchange="updateVerifyButton('appVerify')">
            <span class="icon">â˜</span>
            <span>${getText('verifyAppCheck3')}</span>
          </label>
        </div>
        <div class="btn-row" style="margin-top: 12px;">
          <a href="https://app.airbridge.io" target="_blank" class="submit-btn secondary" style="text-decoration: none; text-align: center;">${getText('verifyHelpBtn')}</a>
          <button class="submit-btn" id="appVerifyBtn" onclick="confirmAppRegistration()" disabled>${getText('verifyConfirmBtn')}</button>
        </div>
      `);
    }

    function updateVerifyButton(type) {
      const container = document.getElementById(type + 'Checklist');
      const checkboxes = container.querySelectorAll('.verify-check');
      const allChecked = Array.from(checkboxes).every(cb => cb.checked);
      const btn = document.getElementById(type + 'Btn');
      if (btn) btn.disabled = !allChecked;
      checkboxes.forEach(cb => {
        const icon = cb.parentElement.querySelector('.icon');
        icon.textContent = cb.checked ? 'âœ…' : 'â˜';
      });
    }

    async function confirmAppRegistration() {
      addUser(getText('verifyConfirmBtn'));
      const msg = state.language === 'en' ? 'App registration verified!' : 'ì•± ë“±ë¡ì´ í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤!';
      await addBot(`<div class="success-box">âœ… ${msg}</div>`);
      await askAppMode();
    }

    async function askAppMode() {
      await addBot(`
        <p>${getText('askAppMode')}</p>
        <div class="warning-box">${getText('appModeWarning')}</div>
        <div class="options-container" style="margin-top: 12px;">
          <button class="option-btn" onclick="selectAppMode('production')">
            <span class="option-icon">ğŸš€</span>
            <div>
              <strong>${getText('productionMode')}</strong>
              <p style="font-size: 12px; color: #64748b; margin-top: 4px;">${getText('productionModeDesc')}</p>
            </div>
          </button>
          <button class="option-btn" onclick="selectAppMode('development')">
            <span class="option-icon">ğŸ”§</span>
            <div>
              <strong>${getText('developmentMode')}</strong>
              <p style="font-size: 12px; color: #64748b; margin-top: 4px;">${getText('developmentModeDesc')}</p>
            </div>
          </button>
        </div>
      `);
    }

    async function selectAppMode(mode) {
      state.appMode = mode;
      addUser(mode === 'production' ? getText('selectedProduction') : getText('selectedDevelopment'));
      await addBot(`<p>${mode === 'production' ? getText('productionTip') : getText('developmentTip')}</p>`);
      await askImplementationMethod();
    }

    async function askImplementationMethod() {
      await addBot(`
        <p>${getText('askImplementation')}</p>
        <div class="options-container">
          <button class="option-btn" onclick="selectImplementationMethod('ai')">
            <span class="option-icon">ğŸ¤–</span>
            <div>
              <strong>${getText('implAI')}</strong>
              <p style="font-size: 12px; color: #64748b; margin-top: 4px;">${getText('implAIDesc')}</p>
            </div>
          </button>
          <button class="option-btn" onclick="selectImplementationMethod('devteam')">
            <span class="option-icon">ğŸ‘¥</span>
            <div>
              <strong>${getText('implDevTeam')}</strong>
              <p style="font-size: 12px; color: #64748b; margin-top: 4px;">${getText('implDevTeamDesc')}</p>
            </div>
          </button>
        </div>
      `);
    }

    async function selectImplementationMethod(method) {
      state.implementationMethod = method;
      addUser(method === 'ai' ? getText('implAISelected') : getText('implDevTeamSelected'));
      await addBot(`<p>${method === 'ai' ? getText('implAIResponse') : getText('implDevTeamResponse')}</p>`);
      await askPlatform();
    }

    async function askPlatform() {
      await addBot(`
        <p>${getText('askPlatform')}</p>
        <div class="options-container">
          <button class="option-btn" onclick="selectPlatform('Flutter')">
            <span class="option-icon">ğŸ’™</span>Flutter
          </button>
          <button class="option-btn" onclick="selectPlatform('React Native')">
            <span class="option-icon">âš›ï¸</span>React Native
          </button>
          <button class="option-btn" onclick="selectPlatform('iOS')">
            <span class="option-icon">ğŸ</span>iOS (Swift)
          </button>
          <button class="option-btn" onclick="selectPlatform('Android')">
            <span class="option-icon">ğŸ¤–</span>Android (Kotlin)
          </button>
        </div>
      `);
    }

    async function selectPlatform(platform) {
      state.platform = platform;
      addUser(platform);
      if (platform === 'Flutter' || platform === 'React Native') {
        await askIOSSupport();
      } else if (platform === 'iOS') {
        state.hasIOS = true;
        await askSDKToken();
      } else {
        state.hasIOS = false;
        await askSDKToken();
      }
    }

    async function askIOSSupport() {
      await addBot(`
        <p>${getText('askiOSSupport')}</p>
        <div class="info-box">${getText('iOSTip')}</div>
        <div class="options-row" style="margin-top: 12px;">
          <button class="option-btn" onclick="setIOSSupport(true)">
            <span class="option-icon">ğŸ</span>${getText('yesiOS')}
          </button>
          <button class="option-btn" onclick="setIOSSupport(false)">
            <span class="option-icon">ğŸ¤–</span>${getText('androidOnly')}
          </button>
        </div>
      `);
    }

    async function setIOSSupport(hasIOS) {
      state.hasIOS = hasIOS;
      addUser(hasIOS ? getText('yesiOS') : getText('androidOnly'));
      await askSDKToken();
    }

    async function askSDKToken() {
      await addBot(`
        <p>${getText('askSDKToken')}</p>
        <div class="step-box">
          <h4>${getText('tokenLocationTitle')}</h4>
          <ol>
            <li><a href="https://app.airbridge.io" target="_blank">app.airbridge.io</a> ${getText('tokenStep1')}</li>
            <li>${getText('tokenStep2')}</li>
            <li>${getText('tokenStep3')}</li>
          </ol>
        </div>
        <div class="input-container">
          <input type="text" class="input-field" id="appNameInput" placeholder="${getText('appNamePlaceholder')}">
          <input type="text" class="input-field" id="sdkTokenInput" placeholder="${getText('sdkTokenPlaceholder')}">
          <button class="submit-btn" onclick="submitSDKToken()">${getText('next')}</button>
        </div>
      `);
    }

    async function submitSDKToken() {
      const appName = document.getElementById('appNameInput').value.trim();
      const token = document.getElementById('sdkTokenInput').value.trim();
      if (!appName || !token) {
        alert(state.language === 'ko' ? 'App Nameê³¼ SDK Tokenì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.' : 'Please enter both App Name and SDK Token.');
        return;
      }
      const tokenRegex = /^[a-f0-9]{32}$/i;
      const isValidFormat = tokenRegex.test(token);
      state.appName = appName;
      state.sdkToken = token;
      addUser(`${appName} / ${token.slice(0, 8)}...`);
      await showTokenVerification(isValidFormat);
    }

    async function showTokenVerification(isValidFormat) {
      const validMsg = isValidFormat ? getText('tokenValid') : getText('tokenInvalid');
      const validClass = isValidFormat ? 'success-box' : 'warning-box';
      await addBot(`
        <div class="${validClass}">${validMsg}</div>
        <div class="step-box" style="margin-top: 12px;">
          <h4>ğŸ” ${getText('tokenVerifyTitle')}</h4>
          <p style="font-size: 13px; color: #64748b; margin-bottom: 8px;">${getText('tokenVerifyDesc')}</p>
          <div class="checklist" id="tokenVerifyChecklist">
            <label class="checklist-item" style="cursor: pointer;">
              <input type="checkbox" class="verify-check" onchange="updateVerifyButton('tokenVerify')">
              <span class="icon">â˜</span>
              <span>${getText('tokenVerifyStep1')}</span>
            </label>
            <label class="checklist-item" style="cursor: pointer;">
              <input type="checkbox" class="verify-check" onchange="updateVerifyButton('tokenVerify')">
              <span class="icon">â˜</span>
              <span>${getText('tokenVerifyStep2')}</span>
            </label>
            <label class="checklist-item" style="cursor: pointer;">
              <input type="checkbox" class="verify-check" onchange="updateVerifyButton('tokenVerify')">
              <span class="icon">â˜</span>
              <span>${getText('tokenVerifyStep3')}</span>
            </label>
          </div>
          <div class="warning-box" style="margin-top: 8px; font-size: 12px;">
            âš ï¸ ${getText('tokenMismatchWarning')}
          </div>
        </div>
        <div class="btn-row" style="margin-top: 12px;">
          <a href="https://app.airbridge.io" target="_blank" class="submit-btn secondary" style="text-decoration: none; text-align: center;">${getText('verifyHelpBtn')}</a>
          <button class="submit-btn" id="tokenVerifyBtn" onclick="confirmTokenVerification()" disabled>${getText('verifyConfirmBtn')}</button>
        </div>
      `);
    }

    async function confirmTokenVerification() {
      addUser(getText('verifyConfirmBtn'));
      await addBot(`<div class="success-box">${getText('basicInfoDone')}</div>`);
      updateProgress(2);
      await askBasicEvents();
    }

    // ========== FLOW: PHASE 2 - EVENTS ==========
    async function askBasicEvents() {
      await addBot(`
        <p>${getText('askEvents')}</p>
        <p>${getText('basicEventsIncluded')}</p>
        <div class="checklist">
          <div class="checklist-item done">
            <span class="icon">âœ…</span>
            <span>${getText('signUp')} (sign_up)</span>
          </div>
          <div class="checklist-item done">
            <span class="icon">âœ…</span>
            <span>${getText('signIn')} (sign_in)</span>
          </div>
        </div>
      `);
      state.events = [
        { name: getText('signUp'), category: 'sign_up' },
        { name: getText('signIn'), category: 'sign_in' }
      ];
      await askRevenueEvents();
    }

    async function askRevenueEvents() {
      await addBot(`
        <p>${getText('askRevenue')}</p>
        <div class="info-box">${getText('revenueTip')}</div>
        <div class="options-row" style="margin-top: 12px;">
          <button class="option-btn" onclick="setRevenueEvents(true)">
            <span class="option-icon">ğŸ’°</span>${getText('yesNeed')}
          </button>
          <button class="option-btn" onclick="setRevenueEvents(false)">
            <span class="option-icon">â­ï¸</span>${getText('skip')}
          </button>
        </div>
      `);
    }

    async function setRevenueEvents(needed) {
      state.needsRevenue = needed;
      addUser(needed ? getText('revenueNeeded') : getText('skipped'));
      if (needed) {
        state.events.push(
          { name: getText('productViewed'), category: 'product_viewed' },
          { name: getText('addToCart'), category: 'add_to_cart' },
          { name: getText('orderCompleted'), category: 'order_completed' }
        );
        await addBot(`
          <p>${getText('revenueAdded')}</p>
          <div class="checklist">
            <div class="checklist-item done"><span class="icon">âœ…</span><span>${getText('productViewed')} (product_viewed)</span></div>
            <div class="checklist-item done"><span class="icon">âœ…</span><span>${getText('addToCart')} (add_to_cart)</span></div>
            <div class="checklist-item done"><span class="icon">âœ…</span><span>${getText('orderCompleted')} (order_completed)</span></div>
          </div>
        `);
      }
      await askAdditionalEvents();
    }

    async function askAdditionalEvents() {
      await addBot(`
        <p>${getText('askAdditionalEvents')}</p>
        <div class="options-row" style="margin-top: 12px;">
          <button class="option-btn" onclick="addCustomEvents()">
            <span class="option-icon">â•</span>${getText('addCustom')}
          </button>
          <button class="option-btn" onclick="skipAdditionalEvents()">
            <span class="option-icon">âœ…</span>${getText('enough')}
          </button>
        </div>
      `);
    }

    async function addCustomEvents() {
      addUser(getText('addCustom'));
      await addBot(`
        <p>${getText('customEventTitle')}</p>
        <p style="font-size: 13px; color: #64748b;">${getText('customEventDesc')}</p>
        <div class="input-container">
          <textarea class="input-field" id="customEventsInput" placeholder="${getText('customEventPlaceholder')}"></textarea>
          <div class="btn-row">
            <button class="submit-btn secondary" onclick="skipAdditionalEvents()">${getText('skip')}</button>
            <button class="submit-btn" onclick="submitCustomEvents()">${getText('addEvents')}</button>
          </div>
        </div>
      `);
    }

    async function submitCustomEvents() {
      const input = document.getElementById('customEventsInput').value.trim();
      if (input) {
        const lines = input.split('\n').filter(l => l.trim());
        const newEvents = lines.map(line => {
          const [name, category] = line.split(',').map(s => s.trim());
          return { name, category: category || name.toLowerCase().replace(/\s+/g, '_') };
        });
        state.events.push(...newEvents);
        addUser(state.language === 'en' ? `${newEvents.length} events added` : `${newEvents.length}ê°œ ì´ë²¤íŠ¸ ì¶”ê°€`);
      }
      await goToPhase3();
    }

    async function skipAdditionalEvents() {
      addUser(getText('enough'));
      await goToPhase3();
    }

    // ========== FLOW: PHASE 3 - CONDITIONAL FEATURES ==========
    async function goToPhase3() {
      updateProgress(3);
      const msg = state.language === 'en'
        ? "Events configured! ğŸ‰ Now let's check if you need <strong>additional features</strong>."
        : "ì´ë²¤íŠ¸ ì„¤ì • ì™„ë£Œ! ğŸ‰ ì´ì œ <strong>ì¶”ê°€ ê¸°ëŠ¥ì´ í•„ìš”í•œì§€</strong> í™•ì¸í• ê²Œìš”.";
      await addBot(`<p>${msg}</p>`);
      await askAdsQuestion();
    }

    async function askAdsQuestion() {
      const askAds = state.language === 'en'
        ? 'Are you acquiring users through <strong>ad campaigns</strong>?'
        : '<strong>ê´‘ê³  ìº í˜ì¸</strong>ìœ¼ë¡œ ìœ ì €ë¥¼ ìœ ì…ì‹œí‚¤ê³  ìˆë‚˜ìš”?';
      await addBot(`
        <p>${askAds}</p>
        <div class="options-row" style="margin-top: 12px;">
          <button class="option-btn" onclick="setAdsUsage(true)">
            <span class="option-icon">ğŸ“¢</span>${getText('yesAds')}
          </button>
          <button class="option-btn" onclick="setAdsUsage(false)">
            <span class="option-icon">ğŸš«</span>${getText('noAds')}
          </button>
        </div>
      `);
    }

    async function setAdsUsage(hasAds) {
      state.hasAds = hasAds;
      addUser(hasAds ? getText('adsYes') : getText('adsNo'));
      if (hasAds) {
        const cardTitle = state.language === 'en' ? 'Attribution Setup Required' : 'ì–´íŠ¸ë¦¬ë·°ì…˜ ì„¤ì • í•„ìš”';
        const cardDesc = state.language === 'en'
          ? 'Dashboard configuration is required to measure ad performance.'
          : 'ê´‘ê³  ì„±ê³¼ë¥¼ ì¸¡ì •í•˜ë ¤ë©´ ëŒ€ì‹œë³´ë“œì—ì„œ ì„¤ì •ì´ í•„ìš”í•´ìš”.';
        await addBot(`
          <div class="feature-card">
            <div class="feature-card-header">
              <span class="icon">ğŸ“Š</span>
              <h5>${cardTitle}</h5>
            </div>
            <p>${cardDesc}</p>
          </div>
        `);
      }
      await askDeeplinkQuestion();
    }

    async function askDeeplinkQuestion() {
      const askDeeplink = state.language === 'en'
        ? 'Do you need <strong>deep linking</strong>?'
        : '<strong>ë”¥ë§í¬</strong>ê°€ í•„ìš”í•˜ì„¸ìš”?';
      const later = state.language === 'en' ? "I'll do it later" : 'ë‚˜ì¤‘ì— í• ê²Œìš”';
      await addBot(`
        <p>${askDeeplink}</p>
        <div class="options-row" style="margin-top: 12px;">
          <button class="option-btn" onclick="setDeeplinkUsage(true)">
            <span class="option-icon">ğŸ”—</span>${getText('yesDeeplink')}
          </button>
          <button class="option-btn" onclick="setDeeplinkUsage(false)">
            <span class="option-icon">â­ï¸</span>${later}
          </button>
        </div>
      `);
    }

    async function setDeeplinkUsage(needed) {
      state.needsDeeplink = needed;
      addUser(needed ? getText('deeplinkNeeded') : (state.language === 'en' ? "I'll do it later" : 'ë‚˜ì¤‘ì— í• ê²Œìš”'));
      if (needed) {
        const cardTitle = state.language === 'en' ? 'Deep Link Setup Included' : 'ë”¥ë§í¬ ì„¤ì • í¬í•¨';
        await addBot(`
          <div class="feature-card">
            <div class="feature-card-header">
              <span class="icon">ğŸ”—</span>
              <h5>${cardTitle}</h5>
            </div>
            <p>${getText('deeplinkAdded')}</p>
          </div>
        `);
      }
      await askUserIdentityQuestion();
    }

    async function askUserIdentityQuestion() {
      const later = state.language === 'en' ? "I'll do it later" : 'ë‚˜ì¤‘ì— í• ê²Œìš”';
      await addBot(`
        <p>${getText('askUserIdentity')}</p>
        <div class="info-box">${getText('userIdentityTip')}</div>
        <div class="options-row" style="margin-top: 12px;">
          <button class="option-btn" onclick="setUserIdentityUsage(true)">
            <span class="option-icon">ğŸ‘¤</span>${getText('yesUserIdentity')}
          </button>
          <button class="option-btn" onclick="setUserIdentityUsage(false)">
            <span class="option-icon">â­ï¸</span>${later}
          </button>
        </div>
      `);
    }

    async function setUserIdentityUsage(needed) {
      state.needsUserIdentity = needed;
      addUser(needed ? getText('userIdentityNeeded') : (state.language === 'en' ? "I'll do it later" : 'ë‚˜ì¤‘ì— í• ê²Œìš”'));
      if (needed) {
        const cardTitle = state.language === 'en' ? 'User Identity Setup Included' : 'ìœ ì € ì‹ë³„ì ì„¤ì • í¬í•¨';
        await addBot(`
          <div class="feature-card">
            <div class="feature-card-header">
              <span class="icon">ğŸ‘¤</span>
              <h5>${cardTitle}</h5>
            </div>
            <p>${getText('userIdentityAdded')}</p>
          </div>
        `);
      }
      if (state.hasIOS) {
        await askIOSSpecificQuestions();
      } else {
        await generateFinalTemplate();
      }
    }

    async function askIOSSpecificQuestions() {
      const intro = state.language === 'en'
        ? 'Since this is an iOS app, <strong>additional settings</strong> are required.'
        : 'iOS ì•±ì´ë¼ <strong>ì¶”ê°€ ì„¤ì •</strong>ì´ í•„ìš”í•´ìš”.';
      const confirmBtn = state.language === 'en' ? 'Got it, include these' : 'ì´í•´í–ˆì–´ìš”, í¬í•¨í•´ì£¼ì„¸ìš”';
      await addBot(`
        <p>${intro}</p>
        <div class="feature-card">
          <div class="feature-card-header">
            <span class="icon">ğŸ</span>
            <h5>${state.language === 'en' ? 'iOS Required Settings' : 'iOS í•„ìˆ˜ ì„¤ì •'}</h5>
          </div>
          <p>${state.language === 'en' ? 'Required due to iOS 14+ privacy policies.' : 'iOS 14 ì´í›„ ê°œì¸ì •ë³´ ë³´í˜¸ ì •ì±…ìœ¼ë¡œ ì¸í•´ í•„ìˆ˜ì…ë‹ˆë‹¤.'}</p>
        </div>
        <div style="margin-top: 12px;">
          <button class="submit-btn" onclick="confirmIOSSettings()">${confirmBtn}</button>
        </div>
      `);
    }

    async function confirmIOSSettings() {
      addUser(state.language === 'en' ? 'Include iOS settings' : 'iOS ì„¤ì • í¬í•¨í•´ì£¼ì„¸ìš”');
      await addBot(`<div class="success-box">${state.language === 'en' ? 'âœ… ATT prompt setup will be included.' : 'âœ… ATT í”„ë¡¬í”„íŠ¸ ì„¤ì •ì„ í¬í•¨í• ê²Œìš”.'}</div>`);
      await generateFinalTemplate();
    }

    // ========== FLOW: PHASE 4 - GENERATE TEMPLATE ==========
    async function generateFinalTemplate() {
      updateProgress(4);
      await addBot(`<p>${state.language === 'en' ? 'Configuration complete! ğŸ‰' : 'ì„¤ì • í™•ì¸ ì™„ë£Œ! ğŸ‰'}</p>`);

      const evtCount = state.language === 'en' ? `${state.events.length}` : `${state.events.length}ê°œ`;
      const yesNo = (val) => val ? `âœ… ${getText('yes')}` : `âŒ ${getText('no')}`;
      let summaryHTML = `<table class="summary-table">
        <tr><th>${getText('summaryItem')}</th><th>${getText('summarySetting')}</th></tr>
        <tr><td>${getText('summaryPlatform')}</td><td>${state.platform}</td></tr>
        <tr><td>${getText('summaryiOS')}</td><td>${yesNo(state.hasIOS)}</td></tr>
        <tr><td>${getText('summaryEvents')}</td><td>${evtCount}</td></tr>
        <tr><td>${getText('summaryRevenue')}</td><td>${state.needsRevenue ? 'âœ…' : 'âŒ'}</td></tr>
        <tr><td>${getText('summaryDeeplink')}</td><td>${state.needsDeeplink ? 'âœ…' : 'âŒ'}</td></tr>
        <tr><td>${getText('summaryUserIdentity')}</td><td>${state.needsUserIdentity ? 'âœ…' : 'âŒ'}</td></tr>
        ${state.hasIOS ? `<tr><td>${getText('summaryATT')}</td><td>âœ…</td></tr>` : ''}
      </table>`;
      await addBot(summaryHTML);

      const template = state.implementationMethod === 'ai' ? generateAITemplate() : generateDevTeamSpec();
      const outputLabel = state.implementationMethod === 'ai' ? getText('pasteToClaudeCode') : getText('sendToDevTeam');
      await addBot(`
        <p>${outputLabel}</p>
        <div class="code-block" id="finalTemplate">
          <button class="copy-btn" onclick="copyToClipboard(document.getElementById('finalTemplate').innerText.replace('${getText('copy')}', '').replace('${getText('copied')}', '').trim(), this)">${getText('copy')}</button>
${template}
        </div>
      `, { delay: 800 });

      await showVerificationGuide();
    }

    function generateAITemplate() {
      const isEn = state.language === 'en';
      const eventsSchema = state.events.map(e => {
        const eventObj = { name: e.name, category: e.category, trigger: '', attributes: {} };
        if (e.category === 'order_completed') {
          eventObj.trigger = 'on_payment_complete';
          eventObj.attributes = {
            orderId: { type: 'string', required: true },
            totalValue: { type: 'number', required: true },
            currency: { type: 'string', required: true, example: 'KRW' }
          };
        } else if (e.category === 'product_viewed') {
          eventObj.trigger = 'on_product_view';
          eventObj.attributes = { productId: { type: 'string', required: true } };
        } else if (e.category === 'add_to_cart') {
          eventObj.trigger = 'on_add_to_cart';
          eventObj.attributes = { productId: { type: 'string', required: true }, quantity: { type: 'number', default: 1 } };
        } else {
          eventObj.trigger = 'on_action';
        }
        return eventObj;
      });

      const config = {
        sdk: 'airbridge',
        app_config: { platform: state.platform, app_name: state.appName, sdk_token: state.sdkToken },
        features: { ios_support: state.hasIOS, deep_link: state.needsDeeplink, user_identity: state.needsUserIdentity, revenue_tracking: state.needsRevenue },
        events: eventsSchema,
        documentation: { sdk_guide: getHelpLink('/guides/getting-started-with-airbridge') }
      };

      const intro = isEn ? 'Implement Airbridge SDK integration based on this config:' : 'ì•„ë˜ ì„¤ì •ì„ ê¸°ë°˜ìœ¼ë¡œ Airbridge SDKë¥¼ ì—°ë™í•´ì¤˜:';
      return `${intro}\n\n${JSON.stringify(config, null, 2)}`;
    }

    function generateDevTeamSpec() {
      const isEn = state.language === 'en';
      const today = new Date().toLocaleDateString(isEn ? 'en-US' : 'ko-KR');
      let spec = isEn
        ? `ğŸ“‹ AIRBRIDGE SDK INTEGRATION SPEC\nDate: ${today}\n\nğŸ“± APP INFO\nâ€¢ Platform: ${state.platform}\nâ€¢ App Name: ${state.appName}\nâ€¢ SDK Token: ${state.sdkToken}\nâ€¢ iOS Support: ${state.hasIOS ? 'Yes' : 'No'}`
        : `ğŸ“‹ AIRBRIDGE SDK ì—°ë™ ëª…ì„¸ì„œ\nì‘ì„±ì¼: ${today}\n\nğŸ“± ì•± ì •ë³´\nâ€¢ í”Œë«í¼: ${state.platform}\nâ€¢ ì•± ì´ë¦„: ${state.appName}\nâ€¢ SDK í† í°: ${state.sdkToken}\nâ€¢ iOS ì§€ì›: ${state.hasIOS ? 'ì˜ˆ' : 'ì•„ë‹ˆì˜¤'}`;

      spec += isEn ? `\n\nğŸ“Œ EVENTS TO TRACK (${state.events.length})` : `\n\nğŸ“Œ íŠ¸ë˜í‚¹í•  ì´ë²¤íŠ¸ (${state.events.length}ê°œ)`;
      state.events.forEach((e, i) => { spec += `\n${i + 1}. ${e.name} (${e.category})`; });

      spec += isEn ? `\n\nğŸ“š REFERENCE\nâ€¢ ${getHelpLink('/guides/getting-started-with-airbridge')}` : `\n\nğŸ“š ì°¸ê³  ë¬¸ì„œ\nâ€¢ ${getHelpLink('/guides/getting-started-with-airbridge')}`;
      return spec;
    }

    async function showVerificationGuide() {
      const isEn = state.language === 'en';
      await addBot(`
        <p>${getText('verificationTitle')}</p>
        <div class="step-box">
          <h4>${getText('realtimeLogTitle')}</h4>
          <ol>
            <li>${getText('verifyStep1')}</li>
            <li><a href="https://app.airbridge.io" target="_blank">app.airbridge.io</a> ${getText('verifyStep2')}</li>
            <li>${getText('verifyStep3')}</li>
            <li>${getText('verifyStep4')}</li>
          </ol>
        </div>
        <div class="mock-ui">
          <div class="mock-ui-header">
            <div class="mock-ui-dot red"></div>
            <div class="mock-ui-dot yellow"></div>
            <div class="mock-ui-dot green"></div>
          </div>
          <div class="mock-ui-content">
            <div class="mock-ui-row"><span class="time">10:23:45</span> | <span class="event">Open</span> | Device: iPhone</div>
            <div class="mock-ui-row highlight"><span class="time">10:23:47</span> | <span class="event">Event</span> | <span class="category">sign_in</span></div>
          </div>
        </div>
        <div class="success-box">${getText('verifySuccess')}</div>
      `, { delay: 600 });

      let checklistItems = `
        <label class="checklist-item" style="cursor: pointer;">
          <input type="checkbox" class="verify-check" onchange="updateFinalVerifyButton()">
          <span class="icon">â˜</span>
          <span>${isEn ? 'Open event received on app launch' : 'ì•± ì‹¤í–‰ ì‹œ Open ì´ë²¤íŠ¸ ìˆ˜ì‹ ë¨'}</span>
        </label>
        <label class="checklist-item" style="cursor: pointer;">
          <input type="checkbox" class="verify-check" onchange="updateFinalVerifyButton()">
          <span class="icon">â˜</span>
          <span>${isEn ? 'sign_in event received on login' : 'ë¡œê·¸ì¸ ì‹œ sign_in ì´ë²¤íŠ¸ ìˆ˜ì‹ ë¨'}</span>
        </label>`;
      if (state.needsRevenue) {
        checklistItems += `<label class="checklist-item" style="cursor: pointer;"><input type="checkbox" class="verify-check" onchange="updateFinalVerifyButton()"><span class="icon">â˜</span><span>${isEn ? 'order_completed event received' : 'order_completed ì´ë²¤íŠ¸ ìˆ˜ì‹ ë¨'}</span></label>`;
      }

      await addBot(`
        <div class="step-box" style="margin-top: 16px;">
          <h4>${isEn ? 'âœ… Final Integration Checklist' : 'âœ… ìµœì¢… ì—°ë™ ì²´í¬ë¦¬ìŠ¤íŠ¸'}</h4>
          <div class="checklist" id="finalVerifyChecklist">${checklistItems}</div>
        </div>
        <div class="btn-row" style="margin-top: 12px;">
          <button class="submit-btn secondary" onclick="showTroubleshooting()">ğŸ”§ ${getText('eventNotShowing')}</button>
          <button class="submit-btn" id="finalVerifyBtn" onclick="confirmFinalVerification()" disabled>${isEn ? 'ğŸ‰ Integration Complete!' : 'ğŸ‰ ì—°ë™ ì™„ë£Œ!'}</button>
        </div>
      `, { delay: 400 });
    }

    function updateFinalVerifyButton() {
      const container = document.getElementById('finalVerifyChecklist');
      const checkboxes = container.querySelectorAll('.verify-check');
      const allChecked = Array.from(checkboxes).every(cb => cb.checked);
      document.getElementById('finalVerifyBtn').disabled = !allChecked;
      checkboxes.forEach(cb => {
        const icon = cb.parentElement.querySelector('.icon');
        icon.textContent = cb.checked ? 'âœ…' : 'â˜';
      });
    }

    async function confirmFinalVerification() {
      addUser(state.language === 'en' ? 'Integration Complete!' : 'ì—°ë™ ì™„ë£Œ!');
      await showNextSteps();
    }

    async function showTroubleshooting() {
      addUser(getText('eventNotShowing'));
      await addBot(`
        <p>${getText('troubleshootTitle')}</p>
        <div class="checklist">
          <div class="checklist-item"><span class="icon">1ï¸âƒ£</span><span>${getText('troubleshoot1')}</span></div>
          <div class="checklist-item"><span class="icon">2ï¸âƒ£</span><span>${getText('troubleshoot2')}</span></div>
          <div class="checklist-item"><span class="icon">3ï¸âƒ£</span><span>${getText('troubleshoot3')}</span></div>
          <div class="checklist-item"><span class="icon">4ï¸âƒ£</span><span>${getText('troubleshoot4')}</span></div>
        </div>
      `);
    }

    async function showNextSteps() {
      let nextStepsHTML = `<p>${getText('nextStepsTitle')}</p><div class="checklist">`;
      if (state.hasAds) {
        nextStepsHTML += `<div class="checklist-item pending"><span class="icon">ğŸ“¢</span><span>${getText('channelIntegration')}</span></div>`;
      }
      if (state.hasIOS) {
        nextStepsHTML += `<div class="checklist-item pending"><span class="icon">ğŸ“Š</span><span>${getText('skanSetup')}</span></div>`;
      }
      nextStepsHTML += `<div class="checklist-item pending"><span class="icon">â³</span><span>${getText('waitData')}</span></div></div>`;
      await addBot(nextStepsHTML);

      await addBot(`
        <div class="success-animation">
          <div class="success-icon">ğŸ‰</div>
          <h2 style="color: #4F46E5; margin-bottom: 8px;">${getText('congrats')}</h2>
          <p style="color: #64748b;">${getText('congratsSubtitle')}</p>
        </div>
        <div style="margin-top: 16px;">
          <a href="${getHelpLink()}" target="_blank" class="submit-btn" style="display: block; text-align: center; text-decoration: none;">${getText('helpCenter')}</a>
        </div>
      `);
    }

    // ========== INIT ==========
    startChat();
  </script>
</body>
</html>